<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.90.0" />
    <meta name="description" content="Official Rafay product documentation. Explore &#34;Learn KOP - Amazon CloudWatch Blueprint&#34; docs and more here. Rafay is a SaaS-first Kubernetes Operations Platform with enterprise-class scalability.">
<meta name="author" content="James Bland">

    <link rel="icon" href="https://awsmedia.s3.amazonaws.com/favicon.ico" type="image/x-icon" />

    <title>Learn KOP - Amazon CloudWatch Blueprint :: Rafay Workshop 1</title>

    
    <link href="/css/nucleus.css?1639173650" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1639173650" rel="stylesheet">
    <link href="/css/hybrid.css?1639173650" rel="stylesheet">
    <link href="/css/featherlight.min.css?1639173650" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1639173650" rel="stylesheet">
    <link href="/css/auto-complete.css?1639173650" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1639173650" rel="stylesheet">
    <link href="/css/theme.css?1639173650" rel="stylesheet">
    <link href="/css/hugo-theme.css?1639173650" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1639173650" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1639173650"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/010_intro/5_blueprint.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><img style="vertical-align:middle" src="https://modernization-workshop-bucket.s3-us-west-2.amazonaws.com/images/logo.png" height="70px">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1639173650"></script>
<script type="text/javascript" src="/js/auto-complete.js?1639173650"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1639173650"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/010_intro.html" title="Learn KOP &amp; EKS - CloudWatch Overview" class="dd-item
        parent
        
        
        ">
      <a href="/010_intro.html">
          Learn KOP &amp; EKS - CloudWatch Overview
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/010_intro/1_setup.html" title="Learn KOP - Initial Setup" class="dd-item ">
        <a href="/010_intro/1_setup.html">
        Learn KOP - Initial Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/2_provision.html" title="Learn KOP - Provision EKS Cluster with Amazon CloudWatch Integration" class="dd-item ">
        <a href="/010_intro/2_provision.html">
        Learn KOP - Provision EKS Cluster with Amazon CloudWatch Integration
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/3_ztka.html" title="Learn KOP - Part 3 - Zero Trust Kubectl" class="dd-item ">
        <a href="/010_intro/3_ztka.html">
        Learn KOP - Part 3 - Zero Trust Kubectl
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/4_namespaces.html" title="Learn KOP - Part 4 - Namespaces" class="dd-item ">
        <a href="/010_intro/4_namespaces.html">
        Learn KOP - Part 4 - Namespaces
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/5_blueprint.html" title="Learn KOP - Amazon CloudWatch Blueprint" class="dd-item active">
        <a href="/010_intro/5_blueprint.html">
        Learn KOP - Amazon CloudWatch Blueprint
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/6_visandmon.html" title="Learn KOP - Part 6 - Visibility and Monitoring" class="dd-item ">
        <a href="/010_intro/6_visandmon.html">
        Learn KOP - Part 6 - Visibility and Monitoring
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/7_polmgmt.html" title="Learn KOP - Part 8 - Policy Management" class="dd-item ">
        <a href="/010_intro/7_polmgmt.html">
        Learn KOP - Part 8 - Policy Management
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/8_deprov.html" title="Learn KOP - Deprovision Cluster" class="dd-item ">
        <a href="/010_intro/8_deprov.html">
        Learn KOP - Deprovision Cluster
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/010_intro/overview.html" title="Learn KOP - Overview" class="dd-item ">
        <a href="/010_intro/overview.html">
        Learn KOP - Overview
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://awsworkshop.io"><i class='fas fa-graduation-cap'></i> Rafay Workshops</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/builders-library/"><i class='fas fa-tools'></i> Rafay Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/blogs/modernizing-with-aws/"><i class='far fa-lightbulb'></i> KOP with AWS</a>
              </li>
          
              <li>
                  <a class="padding" href="https://eksworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> EKS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://ecsworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> ECS Workshop</a>
              </li>
          
              <li>
                  <a class="padding" href="https://www.appmeshworkshop.com/"><i class='fas fa-chalkboard-teacher'></i> App Mesh Workshop</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a
        href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | <a
        href="https://modernization-workshop-bucket.s3-us-west-2.amazonaws.com/license/cc-license.html">CC BY-SA 4.0</a>

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Rafay Multi-Cluster Management Workshop</a> > <a href='/010_intro.html'>Learn KOP & EKS - CloudWatch Overview</a> > Learn KOP - Amazon CloudWatch Blueprint
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        




<h2 id="what-will-you-do">What Will You Do</h2>

<p>In this part of the self-paced exercise, you will create a custom cluster blueprint with a <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html" target="_blank">Amazon CloudWatch Agent</a> add-on, based on declarative specifications.</p>

<hr />

<h2 id="step-1-create-repository">Step 1: Create Repository</h2>

<p>In this step, you will create a repository in your project so that the controller can retrieve the Helm charts automatically.</p>

<ul>
<li>Open Terminal (on macOS/Linux) or Command Prompt (Windows) and navigate to the folder where you forked the Git repository</li>
<li>Navigate to the folder &ldquo;<your folder>/getstarted/cloudwatch/repository&rdquo;</li>
</ul>

<p>The &ldquo;cloudwatch-repository.yaml&rdquo; file contains the declarative specification for the repository. In this case, the specification is of type &ldquo;Helm Repository&rdquo; and the &ldquo;endpoint&rdquo; is pointing to the AWS Github repository that includes the CloudWatch Helm chart.</p>
<pre tabindex="0"><code class="language-yaml hl_lines="6 7"" data-lang="yaml hl_lines="6 7"">apiVersion: config.rafay.dev/v2
kind: Repository
metadata:
  name: cloudwatch-repo
spec:
  repositoryType: HelmRepository
  endpoint:  https://aws.github.io/eks-charts
  credentialType: CredentialTypeNotSet</code></pre>
<p>Type the command below</p>
<pre tabindex="0"><code>rctl create repository -f cloudwatch-repository.yaml</code></pre>
<p>If you did not encounter any errors, you can optionally verify if everything was created correctly on the controller.</p>

<ul>
<li>Navigate to the &ldquo;defaultproject&rdquo; project in your Org</li>
<li>Select Integrations -&gt; Repositories</li>
</ul>

<p><img src="img/blueprint/add_repository.png" alt="Repository" /></p>

<hr />

<h2 id="step-2-create-namespace">Step 2: Create Namespace</h2>

<p>In this step, you will create a namespace for the Cloudwatch agent. The &ldquo;cloudwatch-namespace.yaml&rdquo; file contains the declarative specification</p>

<p>The following items may need to be updated/customized if you made changes to these or used alternate names.</p>

<ul>
<li><p>value: cloudwatch-cluster</p>
<pre tabindex="0"><code class="language-yaml hl_lines="4 15"" data-lang="yaml hl_lines="4 15"">kind: ManagedNamespace
apiVersion: config.rafay.dev/v2
metadata:
name: amazon-cloudwatch
description: namespace for Amazon Cloudwatch
labels:
annotations:
spec:
type: RafayWizard
resourceQuota:
placement:
placementType: ClusterSpecific
clusterLabels:
- key: rafay.dev/clusterName
  value: cloudwatch-cluster</code></pre></li>

<li><p>Open Terminal (on macOS/Linux) or Command Prompt (Windows) and navigate to the folder where you forked the Git repository</p></li>

<li><p>Navigate to the folder &ldquo;<your folder>/getstarted/cloudwatch/namespace&rdquo;</p></li>

<li><p>Type the command below</p>
<pre tabindex="0"><code>rctl create namespace -f cloudwatch-namespace.yaml</code></pre></li>
</ul>

<p>If you did not encounter any errors, you can optionally verify if everything was created correctly on the controller.</p>

<ul>
<li>Navigate to the &ldquo;defaultproject&rdquo; project in your Org</li>
<li>Select Infrastructure -&gt; Namespaces</li>
<li>You should see an namesapce called &ldquo;amazon-cloudwatch&rdquo;</li>
</ul>

<p><img src="img/blueprint/cloudwatch_namespace.png" alt="Cloudwatch Agent Namespace" /></p>

<hr />

<h2 id="step-3-create-addon">Step 3: Create Addon</h2>

<p>In this step, you will create a custom addon for the Cloudwatch Agent. The &ldquo;cloudwatch-addon.yaml&rdquo; file contains the declarative specification</p>

<p>If you plan to use a different name for the cluster other than &ldquo;cloudwatch-cluster&rdquo;, you must update the &ldquo;custom-values.yaml&rdquo; file located in the folder &ldquo;<your folder>/getstarted/cloudwatch/addon&rdquo; with the name of the cluster</p>

<p>The following details are used to build the declarative specification.</p>

<ul>
<li>&ldquo;v1&rdquo; because this is our first version</li>
<li>The addon is part of the &ldquo;defaultproject&rdquo;</li>
<li>Name of addon is &ldquo;cloudwatch-addon&rdquo;</li>
<li>The addon will be deployed to a namespace called &ldquo;amazon-cloudwatch&rdquo;</li>
<li>You will be using a custom &ldquo;custom-values.yaml as an override which is located in the folder &ldquo;<your folder>/getstarted/cloudwatch/addon&rdquo;<br /></li>
<li>The &ldquo;aws-cloudwatch-metrics&rdquo; chart will be used from the previously created repository named &ldquo;cloudwatch-repo&rdquo;</li>
</ul>

<p>The following items may need to be updated/customized if you made changes to these or used alternate names.</p>

<ul>
<li><p>repository_ref: &ldquo;cloudwatch-repo&rdquo;</p>
<pre tabindex="0"><code class="language-yaml hl_lines="3 4 6 7 10 11"" data-lang="yaml hl_lines="3 4 6 7 10 11"">kind: AddonVersion
metadata:
name: v1
project: defaultproject
spec:
addon: cloudwatch-addon
namespace: amazon-cloudwatch
template:
type: Helm3
valuesFile: custom-values.yaml
repository_ref: cloudwatch-repo
repo_artifact_meta:
  helm:
   chartName: aws-cloudwatch-metrics</code></pre></li>

<li><p>Open Terminal (on macOS/Linux) or Command Prompt (Windows) and navigate to the folder where you forked the Git repository</p></li>

<li><p>Navigate to the folder &ldquo;<your folder>/getstarted/cloudwatch/addon&rdquo;</p></li>

<li><p>Type the command below</p>
<pre tabindex="0"><code>rctl create addon version -f cloudwatch-addon.yaml</code></pre></li>
</ul>

<p>If you did not encounter any errors, you can optionally verify if everything was created correctly on the controller.</p>

<ul>
<li>Navigate to the &ldquo;defaultproject&rdquo; project in your Org</li>
<li>Select Infrastructure -&gt; Addons</li>
<li>You should see an addon called &ldquo;cloudwatch-addon&rdquo;</li>
</ul>

<p><img src="img/blueprint/cloudwatch_addon.png" alt="CloudWatch Agent Addon" /></p>

<hr />

<h2 id="step-4-create-blueprint">Step 4: Create Blueprint</h2>

<p>In this step, you will create a custom cluster blueprint with the CloudWatch addon. The &ldquo;cloudwatch-blueprint.yaml&rdquo; file contains the declarative specification.</p>

<ul>
<li>Open Terminal (on macOS/Linux) or Command Prompt (Windows) and navigate to the folder where you forked the Git repository</li>
<li>Navigate to the folder &ldquo;<your folder>/getstarted/cloudwatch/blueprint&rdquo;<br /></li>
</ul>

<p>The following items may need to be updated/customized if you made changes to these or used alternate names.</p>

<ul>
<li><p>project: &ldquo;defaultproject&rdquo;</p>
<pre tabindex="0"><code class="language-yaml hl_lines="4 6"" data-lang="yaml hl_lines="4 6"">kind: Blueprint
metadata:
# blueprint name
name: cloudwatch-blueprint
#project name
project: defaultproject</code></pre></li>

<li><p>Type the command below</p>
<pre tabindex="0"><code>rctl create blueprint -f cloudwatch-blueprint.yaml</code></pre></li>
</ul>

<p>If you did not encounter any errors, you can optionally verify if everything was created correctly on the controller.</p>

<ul>
<li>Navigate to the &ldquo;defaultproject&rdquo; project in your Org</li>
<li>Select Infrastructure -&gt; Blueprint</li>
<li>You should see an blueprint called &ldquo;cloudwatch-blueprint</li>
</ul>

<p><img src="img/blueprint/cloudwatch_blueprint.png" alt="CloudWatch Blueprint" /></p>

<hr />

<h3 id="new-version">New Version</h3>

<p>Although we have a custom blueprint, we have not provided any details on what it comprises. In this step, you will create and add a new version to the custom blueprint. The YAML below is a declarative spec for the new version.</p>

<p>The following items may need to be updated/customized if you made changes to these or used alternate names.</p>

<ul>
<li>project: &ldquo;defaultproject&rdquo;</li>
<li>blueprint: &ldquo;cloudwatch-blueprint&rdquo;</li>
<li>name: &ldquo;cloudwatch-addon&rdquo;</li>

<li><p>version: &ldquo;v1&rdquo;</p>
<pre tabindex="0"><code class="language-yaml hl_lines="4 7 11 12"" data-lang="yaml hl_lines="4 7 11 12"">kind: BlueprintVersion
metadata:
name: v1
project: defaultproject
description: Amazon CloudWatch Agent
spec:
blueprint: cloudwatch-blueprint
baseSystemBlueprint: default
baseSystemBlueprintVersion: &#34;&#34;
addons:
- name: cloudwatch-addon
  version: v1
# cluster-scoped or namespace-scoped
pspScope: cluster-scoped
rafayIngress: true
rafayMonitoringAndAlerting: false
kubevirt: false
# BlockAndNotify or DetectAndNotify
driftAction: BlockAndNotify</code></pre></li>

<li><p>Type the command below to add a new version</p>
<pre tabindex="0"><code>rctl create blueprint version -f cloudwatch-blueprint-v1.yaml</code></pre></li>
</ul>

<p>If you did not encounter any errors, you can optionally verify if everything was created correctly on the controller.</p>

<ul>
<li>Navigate to the &ldquo;defaultproject&rdquo; project in your Org</li>
<li>Select Infrastructure -&gt; Blueprint</li>
<li>Click on the &ldquo;cloudwatch-blueprint&rdquo; custom cluster blueprint</li>
</ul>

<p><img src="img/blueprint/cloudwatch_blueprint_newversion.png" alt="v1 CloudWatch Blueprint" /></p>

<hr />

<h2 id="recap">Recap</h2>

<p>As of this step, you have created a &ldquo;cluster blueprint&rdquo; with the CloudWatch agent as one of the addons. You are now ready to move onto the next step where you will provision an EKS cluster with this custom cluster blueprint.</p>

<p>Note that you can also reuse this cluster blueprint for as many clusters as you require in this project and also share the blueprint with other projects.</p>

<hr />


<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/010_intro/4_namespaces.html" title="Learn KOP - Part 4 - Namespaces"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/010_intro/6_visandmon.html" title="Learn KOP - Part 6 - Visibility and Monitoring" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1639173650"></script>
    <script src="/js/perfect-scrollbar.min.js?1639173650"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1639173650"></script>
    <script src="/js/jquery.sticky.js?1639173650"></script>
    <script src="/js/featherlight.min.js?1639173650"></script>
    <script src="/js/highlight.pack.js?1639173650"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1639173650"></script>
    <script src="/js/learn.js?1639173650"></script>
    <script src="/js/hugo-learn.js?1639173650"></script>
    
        
            <script src="/mermaid/mermaid.js?1639173650"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

